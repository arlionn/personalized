<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Validating fitted subgroup identification models — validate.subgroup • personalized</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Validating fitted subgroup identification models — validate.subgroup" />
<meta property="og:description" content="Validates subgroup treatment effects for fitted
 subgroup identification model class of Chen, et al (2017)" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">personalized</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/usage_of_the_personalized_package.html">Usage of the personalized Package</a>
    </li>
    <li>
      <a href="../articles/efficiency_augmentation_personalized.html">Improving Estimation Efficiency via Augmentation and Propensity Score Utilities</a>
    </li>
    <li>
      <a href="../articles/multicategory_treatments_with_personalized.html">Multi-category Treatments with personalized</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/jaredhuling/personalized">
    <span class="fas fa-github"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Validating fitted subgroup identification models</h1>
    <small class="dont-index">Source: <a href='https://github.com/jaredhuling/personalized/blob/master/R/validate_subgroup.R'><code>R/validate_subgroup.R</code></a></small>
    <div class="hidden name"><code>validate.subgroup.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Validates subgroup treatment effects for fitted
 subgroup identification model class of Chen, et al (2017)</p>
    </div>

    <pre class="usage"><span class='fu'>validate.subgroup</span><span class='op'>(</span>
  <span class='va'>model</span>,
  B <span class='op'>=</span> <span class='fl'>50L</span>,
  method <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"training_test_replication"</span>, <span class='st'>"boot_bias_correction"</span><span class='op'>)</span>,
  train.fraction <span class='op'>=</span> <span class='fl'>0.75</span>,
  benefit.score.quantiles <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.1666667</span>, <span class='fl'>0.3333333</span>, <span class='fl'>0.5</span>, <span class='fl'>0.6666667</span>, <span class='fl'>0.8333333</span><span class='op'>)</span>,
  parallel <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>model</th>
      <td><p>fitted model object returned by <code><a href='fit.subgroup.html'>fit.subgroup()</a></code> function</p></td>
    </tr>
    <tr>
      <th>B</th>
      <td><p>integer. number of bootstrap replications or refitting replications.</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>validation method. <code>"boot_bias_correction"</code> for the bootstrap
bias correction method of Harrell, et al (1996) or <code>"training_test_replication"</code>
for repeated training and test splitting of the data (<code>train.fraction</code> should be specified
for this option)</p></td>
    </tr>
    <tr>
      <th>train.fraction</th>
      <td><p>fraction (between 0 and 1) of samples to be used for training in
training/test replication. Only used for <code>method = "training_test_replication"</code></p></td>
    </tr>
    <tr>
      <th>benefit.score.quantiles</th>
      <td><p>a vector of quantiles (between 0 and 1) of the benefit score values
for which to return bootstrapped information about the subgroups. ie if one of the quantile values is 0.5, the
median value of the benefit scores will be used as a cutoff to determine subgroups and summary statistics
will be returned about these subgroups</p></td>
    </tr>
    <tr>
      <th>parallel</th>
      <td><p>Should the loop over replications be parallelized? If <code>FALSE</code>, then no, if <code>TRUE</code>, then yes.
If user sets <code>parallel = TRUE</code> and the fitted <code><a href='fit.subgroup.html'>fit.subgroup()</a></code> object uses the parallel version of
an internal model, say for <code>cv.glmnet()</code>, then the internal parallelization will be overridden so as
not to create a conflict of parallelism.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class <code>"subgroup_validated"</code></p>
<dt>avg.results</dt><dd><p>Estimates of average conditional treatment effects when
subgroups are determined based on the provided cutoff value for the benefit score. For example,
if <code>cutoff = 0</code> and there is a treatment and control only, then the treatment is
recommended if the benefit score is greater than 0.</p></dd>
<dt>se.results</dt><dd><p>Standard errors of the estimates from <code>avg.estimates</code></p></dd>
<dt>boot.results</dt><dd><p>Contains the individual results for each replication. <code>avg.results</code> is comprised
of averages of the values from <code>boot.results</code></p></dd>
<dt>avg.quantile.results</dt><dd><p>Estimates of average conditional treatment effects when
subgroups are determined based on different quntile cutoff values for the benefit score. For example,
if <code>benefit.score.quantiles = 0.75</code> and there is a treatment and control only, then the treatment is
recommended if the benefit score is greater than the 75th upper quantile of all benefit scores. If multiple quantile
values are provided, e.g. <code>benefit.score.quantiles = c(0.15, 0.5, 0.85)</code>, then results will be provided
for all quantile levels.</p></dd>
<dt>se.quantile.results</dt><dd><p>Standard errors corresponding to <code>avg.quantile.results</code></p></dd>
<dt>boot.results.quantiles</dt><dd><p>Contains the individual results for each replication. <code>avg.quantile.results</code> is comprised
of averages of the values from <code>boot.results.quantiles</code></p></dd>
<dt>family</dt><dd><p>Family of the outcome. For example, <code>"gaussian"</code> for continuous outcomes</p></dd>
<dt>method</dt><dd><p>Method used for subgroup identification model. Weighting or A-learning</p></dd>
<dt>n.trts</dt><dd><p>The number of treatment levels</p></dd>
<dt>comparison.trts</dt><dd><p>All treatment levels other than the reference level</p></dd>
<dt>reference.trt</dt><dd><p>The reference level for the treatment. This should usually be the control group/level</p></dd>
<dt>larger.outcome.better</dt><dd><p>If larger outcomes are preferred for this model</p></dd>
<dt>cutpoint</dt><dd><p>Benefit score cutoff value used for determining subgroups</p></dd>
<dt>val.method</dt><dd><p>Method used for validation</p></dd>
<dt>iterations</dt><dd><p>Number of replications used in the validation process</p></dd>
<dt>nobs</dt><dd><p>Number of observations in <code>x</code> provided to <code><a href='fit.subgroup.html'>fit.subgroup</a></code></p></dd>
<dt>nvars</dt><dd><p>Number of variables in <code>x</code> provided to <code><a href='fit.subgroup.html'>fit.subgroup</a></code></p></dd>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Estimates of various quantities conditional on subgroups and treatment statuses are provided and displayed
via the <code><a href='print.subgroup_fitted.html'>print.subgroup_validated</a></code> function:</p><ol>
<li><p>"Conditional expected outcomes" The first results shown when printing
a <code>subgroup_validated</code> object are estimates of the expected outcomes conditional on
the estimated subgroups (i.e. which subgroup is 'recommended' by the model) and conditional
on treatment/intervention status. If there are two total treatment options, this results in a 2x2 table
of expected conditional outcomes.</p></li>
<li><p>"Treatment effects conditional on subgroups" The second results shown when printing
a <code>subgroup_validated</code> object are estimates of the expected outcomes conditional on
the estimated subgroups. If the treatment takes levels \(j \in \{1, \dots, K\}\), a total of \(K\)
conditional treatment effects will be shown. For example, of the outcome is continuous, the
\(j\)th conditional treatment effect is defined as \(E(Y|Trt = j, Subgroup=j) - E(Y|Trt = j, Subgroup =/= j)\),
where \(Subgroup=j\) if treatment \(j\) is recommended, i.e. treatment \(j\) results in the largest/best
expected potential outcomes given the fitted model.</p></li>
<li><p>"Overall treatment effect conditional on subgroups " The third quantity displayed shows the overall improvement
in outcomes resulting from all treatment recommendations. This is essentially an average over all of the
conditional treatment effects weighted by the proportion of the population recommended each respective
treatment level.</p></li>
</ol>

    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Chen, S., Tian, L., Cai, T. and Yu, M. (2017), A general statistical framework for subgroup identification
and comparative treatment scoring. Biometrics. doi:10.1111/biom.12676</p>
<p>Harrell, F. E., Lee, K. L., and Mark, D. B. (1996). Tutorial in biostatistics multivariable prognostic models: issues in developing models,
evaluating assumptions and adequacy, and measuring and reducing errors. Statistics in medicine, 15, 361-387.
doi:10.1002/(SICI)1097-0258(19960229)15:4&lt;361::AID-SIM168&gt;3.0.CO;2-4</p>
<p>Huling. J.D. and Yu, M. (2021), Subgroup Identification Using the personalized Package.
Journal of Statistical Software 98(5), 1-60. doi:10.18637/jss.v098.i05</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='fit.subgroup.html'>fit.subgroup</a></code> for function which fits subgroup identification models,
<code><a href='plot.subgroup_fitted.html'>plot.subgroup_validated</a></code> for plotting of validation results, and
<code><a href='print.subgroup_fitted.html'>print.subgroup_validated</a></code> for arguments for printing options for <code>validate.subgroup()</code>.</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://jaredhuling.org/personalized/'>personalized</a></span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>123</span><span class='op'>)</span>
<span class='va'>n.obs</span>  <span class='op'>&lt;-</span> <span class='fl'>500</span>
<span class='va'>n.vars</span> <span class='op'>&lt;-</span> <span class='fl'>20</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>n.obs</span> <span class='op'>*</span> <span class='va'>n.vars</span>, sd <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>, <span class='va'>n.obs</span>, <span class='va'>n.vars</span><span class='op'>)</span>


<span class='co'># simulate non-randomized treatment</span>
<span class='va'>xbetat</span>   <span class='op'>&lt;-</span> <span class='fl'>0.5</span> <span class='op'>+</span> <span class='fl'>0.5</span> <span class='op'>*</span> <span class='va'>x</span><span class='op'>[</span>,<span class='fl'>11</span><span class='op'>]</span> <span class='op'>-</span> <span class='fl'>0.5</span> <span class='op'>*</span> <span class='va'>x</span><span class='op'>[</span>,<span class='fl'>13</span><span class='op'>]</span>
<span class='va'>trt.prob</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>xbetat</span><span class='op'>)</span> <span class='op'>/</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>xbetat</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>trt01</span>    <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Binomial.html'>rbinom</a></span><span class='op'>(</span><span class='va'>n.obs</span>, <span class='fl'>1</span>, prob <span class='op'>=</span> <span class='va'>trt.prob</span><span class='op'>)</span>

<span class='va'>trt</span>      <span class='op'>&lt;-</span> <span class='fl'>2</span> <span class='op'>*</span> <span class='va'>trt01</span> <span class='op'>-</span> <span class='fl'>1</span>

<span class='co'># simulate response</span>
<span class='va'>delta</span> <span class='op'>&lt;-</span> <span class='fl'>2</span> <span class='op'>*</span> <span class='op'>(</span><span class='fl'>0.5</span> <span class='op'>+</span> <span class='va'>x</span><span class='op'>[</span>,<span class='fl'>2</span><span class='op'>]</span> <span class='op'>-</span> <span class='va'>x</span><span class='op'>[</span>,<span class='fl'>3</span><span class='op'>]</span> <span class='op'>-</span> <span class='va'>x</span><span class='op'>[</span>,<span class='fl'>11</span><span class='op'>]</span> <span class='op'>+</span> <span class='va'>x</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span> <span class='op'>*</span> <span class='va'>x</span><span class='op'>[</span>,<span class='fl'>12</span><span class='op'>]</span><span class='op'>)</span>
<span class='va'>xbeta</span> <span class='op'>&lt;-</span> <span class='va'>x</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span> <span class='op'>+</span> <span class='va'>x</span><span class='op'>[</span>,<span class='fl'>11</span><span class='op'>]</span> <span class='op'>-</span> <span class='fl'>2</span> <span class='op'>*</span> <span class='va'>x</span><span class='op'>[</span>,<span class='fl'>12</span><span class='op'>]</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='va'>x</span><span class='op'>[</span>,<span class='fl'>13</span><span class='op'>]</span>
<span class='va'>xbeta</span> <span class='op'>&lt;-</span> <span class='va'>xbeta</span> <span class='op'>+</span> <span class='va'>delta</span> <span class='op'>*</span> <span class='va'>trt</span>

<span class='co'># continuous outcomes</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/drop.html'>drop</a></span><span class='op'>(</span><span class='va'>xbeta</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>n.obs</span>, sd <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>

<span class='co'># create function for fitting propensity score model</span>
<span class='va'>prop.func</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>trt</span><span class='op'>)</span>
<span class='op'>{</span>
    <span class='co'># fit propensity score model</span>
    <span class='va'>propens.model</span> <span class='op'>&lt;-</span> <span class='fu'>cv.glmnet</span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>trt</span>,
                               x <span class='op'>=</span> <span class='va'>x</span>, family <span class='op'>=</span> <span class='st'>"binomial"</span><span class='op'>)</span>
    <span class='va'>pi.x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>propens.model</span>, s <span class='op'>=</span> <span class='st'>"lambda.min"</span>,
                    newx <span class='op'>=</span> <span class='va'>x</span>, type <span class='op'>=</span> <span class='st'>"response"</span><span class='op'>)</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span>
    <span class='va'>pi.x</span>
<span class='op'>}</span>

<span class='va'>subgrp.model</span> <span class='op'>&lt;-</span> <span class='fu'><a href='fit.subgroup.html'>fit.subgroup</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span>,
                             trt <span class='op'>=</span> <span class='va'>trt01</span>,
                             propensity.func <span class='op'>=</span> <span class='va'>prop.func</span>,
                             loss   <span class='op'>=</span> <span class='st'>"sq_loss_lasso"</span>,
                             nfolds <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>    <span class='co'># option for cv.glmnet</span>


<span class='va'>x.test</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>10</span> <span class='op'>*</span> <span class='va'>n.obs</span> <span class='op'>*</span> <span class='va'>n.vars</span>, sd <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>, <span class='fl'>10</span> <span class='op'>*</span> <span class='va'>n.obs</span>, <span class='va'>n.vars</span><span class='op'>)</span>


<span class='co'># simulate non-randomized treatment</span>
<span class='va'>xbetat.test</span>   <span class='op'>&lt;-</span> <span class='fl'>0.5</span> <span class='op'>+</span> <span class='fl'>0.5</span> <span class='op'>*</span> <span class='va'>x.test</span><span class='op'>[</span>,<span class='fl'>11</span><span class='op'>]</span> <span class='op'>-</span> <span class='fl'>0.5</span> <span class='op'>*</span> <span class='va'>x.test</span><span class='op'>[</span>,<span class='fl'>13</span><span class='op'>]</span>
<span class='va'>trt.prob.test</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>xbetat.test</span><span class='op'>)</span> <span class='op'>/</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>xbetat.test</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>trt01.test</span>    <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Binomial.html'>rbinom</a></span><span class='op'>(</span><span class='fl'>10</span> <span class='op'>*</span> <span class='va'>n.obs</span>, <span class='fl'>1</span>, prob <span class='op'>=</span> <span class='va'>trt.prob.test</span><span class='op'>)</span>

<span class='va'>trt.test</span>      <span class='op'>&lt;-</span> <span class='fl'>2</span> <span class='op'>*</span> <span class='va'>trt01.test</span> <span class='op'>-</span> <span class='fl'>1</span>

<span class='co'># simulate response</span>
<span class='va'>delta.test</span> <span class='op'>&lt;-</span> <span class='fl'>2</span> <span class='op'>*</span> <span class='op'>(</span><span class='fl'>0.5</span> <span class='op'>+</span> <span class='va'>x.test</span><span class='op'>[</span>,<span class='fl'>2</span><span class='op'>]</span> <span class='op'>-</span> <span class='va'>x.test</span><span class='op'>[</span>,<span class='fl'>3</span><span class='op'>]</span> <span class='op'>-</span> <span class='va'>x.test</span><span class='op'>[</span>,<span class='fl'>11</span><span class='op'>]</span> <span class='op'>+</span> <span class='va'>x.test</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span> <span class='op'>*</span> <span class='va'>x.test</span><span class='op'>[</span>,<span class='fl'>12</span><span class='op'>]</span><span class='op'>)</span>
<span class='va'>xbeta.test</span> <span class='op'>&lt;-</span> <span class='va'>x.test</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span> <span class='op'>+</span> <span class='va'>x.test</span><span class='op'>[</span>,<span class='fl'>11</span><span class='op'>]</span> <span class='op'>-</span> <span class='fl'>2</span> <span class='op'>*</span> <span class='va'>x.test</span><span class='op'>[</span>,<span class='fl'>12</span><span class='op'>]</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='va'>x.test</span><span class='op'>[</span>,<span class='fl'>13</span><span class='op'>]</span>
<span class='va'>xbeta.test</span> <span class='op'>&lt;-</span> <span class='va'>xbeta.test</span> <span class='op'>+</span> <span class='va'>delta.test</span> <span class='op'>*</span> <span class='va'>trt.test</span>

<span class='va'>y.test</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/drop.html'>drop</a></span><span class='op'>(</span><span class='va'>xbeta.test</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>10</span> <span class='op'>*</span> <span class='va'>n.obs</span>, sd <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>

<span class='va'>valmod</span> <span class='op'>&lt;-</span> <span class='fu'>validate.subgroup</span><span class='op'>(</span><span class='va'>subgrp.model</span>, B <span class='op'>=</span> <span class='fl'>3</span>,
                            method <span class='op'>=</span> <span class='st'>"training_test"</span>,
                            train.fraction <span class='op'>=</span> <span class='fl'>0.75</span><span class='op'>)</span>
<span class='va'>valmod</span>
</div><div class='output co'>#&gt; family:  gaussian 
#&gt; loss:    sq_loss_lasso 
#&gt; method:  weighting 
#&gt; 
#&gt; validation method:  training_test_replication 
#&gt; cutpoint:           0 
#&gt; replications:       3 
#&gt; 
#&gt; benefit score: f(x), 
#&gt; Trt recom = 1*I(f(x)&gt;c)+0*I(f(x)&lt;=c) where c is 'cutpoint'
#&gt; 
#&gt; Average Test Set Outcomes:
#&gt;                                  Recommended 0
#&gt; Received 0 -14.925 (SE = 13.5505, n = 12.6667)
#&gt; Received 1        -18.6798 (SE = 2.02, n = 40)
#&gt;                                  Recommended 1
#&gt; Received 0     -19.1219 (SE = 10.6593, n = 41)
#&gt; Received 1 -11.4523 (SE = 3.3954, n = 31.3333)
#&gt; 
#&gt; Treatment effects conditional on subgroups:
#&gt; Est of E[Y|T=0,Recom=0]-E[Y|T=/=0,Recom=0] 
#&gt;         3.7548 (SE = 15.5211, n = 52.6667) 
#&gt; Est of E[Y|T=1,Recom=1]-E[Y|T=/=1,Recom=1] 
#&gt;          7.6696 (SE = 8.0796, n = 72.3333) 
#&gt; 
#&gt; Est of 
#&gt; E[Y|Trt received = Trt recom] - E[Y|Trt received =/= Trt recom]:                     
#&gt; 5.9962 (SE = 1.3495) </div><div class='input'>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>valmod</span>, which.quant <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>4</span>, <span class='fl'>5</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; family:  gaussian 
#&gt; loss:    sq_loss_lasso 
#&gt; method:  weighting 
#&gt; 
#&gt; validation method:  training_test_replication 
#&gt; cutpoint:           Quant_67 
#&gt; replications:       3 
#&gt; 
#&gt; benefit score: f(x), 
#&gt; Trt recom = 1*I(f(x)&gt;c)+0*I(f(x)&lt;=c) where c is 'cutpoint'
#&gt; 
#&gt; Average Test Set Outcomes:
#&gt;                              Recommended 0                       Recommended 1
#&gt; Received 0 -12.0424 (SE = 13.3332, n = 26) -31.4333 (SE = 7.6003, n = 27.6667)
#&gt; Received 1  -16.8643 (SE = 0.9889, n = 58)  -8.8913 (SE = 4.8159, n = 13.3333)
#&gt; 
#&gt; Treatment effects conditional on subgroups:
#&gt; Est of E[Y|T=0,Recom=0]-E[Y|T=/=0,Recom=0] 
#&gt;              4.8219 (SE = 12.7916, n = 84) 
#&gt; Est of E[Y|T=1,Recom=1]-E[Y|T=/=1,Recom=1] 
#&gt;             22.5419 (SE = 11.7745, n = 41) 
#&gt; 
#&gt; Est of E[Y|Trt received = Trt recom] - E[Y|Trt received =/= Trt recom]:                      
#&gt; 10.5675 (SE = 9.0892) 
#&gt; 
#&gt; &lt;===============================================&gt;
#&gt; 
#&gt; family:  gaussian 
#&gt; loss:    sq_loss_lasso 
#&gt; method:  weighting 
#&gt; 
#&gt; validation method:  training_test_replication 
#&gt; cutpoint:           Quant_83 
#&gt; replications:       3 
#&gt; 
#&gt; benefit score: f(x), 
#&gt; Trt recom = 1*I(f(x)&gt;c)+0*I(f(x)&lt;=c) where c is 'cutpoint'
#&gt; 
#&gt; Average Test Set Outcomes:
#&gt;                              Recommended 0                       Recommended 1
#&gt; Received 0 -14.0302 (SE = 10.6136, n = 37) -32.4616 (SE = 6.5468, n = 16.6667)
#&gt; Received 1  -16.3633 (SE = 0.9549, n = 66)  -9.1074 (SE = 15.3114, n = 5.3333)
#&gt; 
#&gt; Treatment effects conditional on subgroups:
#&gt; Est of E[Y|T=0,Recom=0]-E[Y|T=/=0,Recom=0] 
#&gt;             2.3331 (SE = 10.4042, n = 103) 
#&gt; Est of E[Y|T=1,Recom=1]-E[Y|T=/=1,Recom=1] 
#&gt;              23.3541 (SE = 11.457, n = 22) 
#&gt; 
#&gt; Est of E[Y|Trt received = Trt recom] - E[Y|Trt received =/= Trt recom]:                     
#&gt; 6.3183 (SE = 8.4968) </div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Jared Huling.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


